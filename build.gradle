
task createSfx << {
	ant.mkdir(dir: 'build')
	ant.exec(
		dir: 'src',
		executable: 'C:\\Program Files (x86)\\7-Zip\\7z.exe',
		failonerror: false,
		vmlauncher: false,
		resultproperty:"cmdExit",
		outputproperty:"cmdOut",
        errorproperty: "cmdErr"
	) {
		arg(line: 'a')
		arg(line: '-t7z')
		arg(line: '..\\build\\Workspace-Setup.7z')
		arg(line: '.\\')
	}
	
	println "return code:  ${ant.project.properties.cmdExit}"
	println """stderr:
${ant.project.properties.cmdErr}
################################"""
	println """stdout:
${ ant.project.properties.cmdOut}
################################"""
	
	if (ant.project.properties.cmdExit != '0') {
		throw new GradleException('Filed to create 7z file.')
	}
	String copyCommand = 'cmd /C copy /Y /b "C:\\Program Files (x86)\\7-Zip\\7zsd.sfx" + src\\config.txt + build\\Workspace-Setup.7z build\\Workspace-Setup.exe'
	println copyCommand
	
	String output = copyCommand.execute().text
	println output
	
	if (!(new File('build/Workspace-Setup.exe')).exists()) {
		throw new GradleException('Filed to create sfx file.')
	}
}